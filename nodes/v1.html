<!--
  Copyright 2017 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="sensor-rotation-to-phrase">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-device-id">
            <i class="fa fa-tag"></i> Device ID</label>
        <input type="text" id="node-input-device-id" placeholder="device ID">
    </div>
    <div class="form-row">
        <label for="node-input-sensitivity">
            <i class="fa fa-balance-scale"></i> Sensitivity</label>
        <input type="number" step="0.01" id="node-input-sensitivity" placeholder="">
    </div>


</script>

<script type="text/x-red" data-help-name="sensor-rotation-to-phrase">
    <p>This node is a sensor rotation interpreter. It expects input from
    an IBM IOT In Node, which has been
    configured to report on device events from a TI Sensor Tag. Consequently
    this node interprets the rotational motion as a phrase providing
    textual instruction for nodes downstream.
    expects the rotational acceleration to be provided as input on
    </p>

    <p><b>Usage</b></p>
    <p>This node expects as input the output from an IBM IOT In Node: </p>
    <ul>
      <li><code>msg.payload.d</code> : The device event from the TI Sensor
      tag. The node makes use of the rotational acceleration to Determine
      motion, and hence interpret that as set phrases. Consequently
      the following input is expected:
      <code>
        msg.payload.d.accelX,
        msg.payload.d.accelY,
        msg.payload.d.accelZ
      </code>
      </li>
    </ul>

    <p>output - <code>msg.payload</code></p>


    <p><b>Configuration</b></p>
    <p>Set the sensitivity to determine how much motion is required
    for rotational motion to be detected.
    </p>
    <p>As the node needs to remember the previous rotational position the
    device id is used to store the last postion in the flow context.</p>
</script>



<script type="text/javascript">
    (function() {
        RED.nodes.registerType('sensor-rotation-to-phrase', {
            category: 'function',
            defaults: {
                name: {value: ""},
                'device-id' : {value: ""},
                sensitivity : {value: 0.5}
            },
            color: "rgb(200,50,50)",
            inputs: 1,
            outputs: 1,
            paletteLabel: "sensor rotation interpreter",
            icon: "bridge.png",
            label: function() {
                return this.name || "sensor rotation interpreter";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic node_label_white" : "node_label_white";
            }
        });
    })();
</script>
